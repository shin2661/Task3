<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	https://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/security 
	http://www.springframework.org/schema/security/spring-security.xsd">
 
	<beans:bean id="loginSuccessHandler" class="com.crizen.task3.security.LoginSuccessHandler"/>
	<beans:bean id="loginFailureHandler" class="com.crizen.task3.security.LoginFailureHandler"/>
	<beans:bean id="accessDeniedHandler" class="com.crizen.task3.security.AccessDeniedHandler"/>

	<http auto-config="true" use-expressions="true">
		<csrf/>
	
		<!-- 정적 리소스는 모두 접근 허용 -->
		<intercept-url pattern="/css/**" access="permitAll" />
		<intercept-url pattern="/js/**" access="permitAll" />

		<intercept-url pattern="/**" access="permitAll" />
		
        <!-- 로그인된 상태에서는 로그인이나 회원가입 화면에 접근 못하도록 함 -->
		<intercept-url pattern="/joinForm.do" access="isAnonymous()" />
		<intercept-url pattern="/loginForm.do" access="isAnonymous()" />
		<intercept-url pattern="/joinPro.do" access="permitAll" />
		
		<!-- 메인페이지는는 모두 접근 허용 -->
		<intercept-url pattern="/main.do" access="permitAll" />
		
		<!-- 관리자페이지는 관리자만 접근 허용 -->
		<intercept-url pattern="/admin/**" access="ROLE_ADMIN" />
		<intercept-url pattern="/user/**" access="ROLE_USER" />
		
		<!-- 로그인 설정 -->
		<form-login login-page="/loginForm.do" 
					default-target-url="/main.do" 
					authentication-failure-handler-ref="loginFailureHandler"
					authentication-success-handler-ref="loginSuccessHandler"
					username-parameter="id" 
					password-parameter="passwd" />
		
		<!-- 로그아웃 설정 -->
		<logout logout-url="/logout" logout-success-url="/main.do" invalidate-session="true"/>
		
		<!-- 권한이 없어서 금지된 URI 접속할 때 보여줄 페이지(403 에러 페이지 대체) -->
<!-- 		<access-denied-handler error-page="/accessDenied.do"/> -->
	</http>
	
	<beans:bean id="customUserDetailsService" class="com.crizen.task3.security.CustomUserDetailsService"/>
	<beans:bean id ="bcryptPasswordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>

    <authentication-manager>
        <authentication-provider user-service-ref="customUserDetailsService">
        	<password-encoder ref="bcryptPasswordEncoder" />
        </authentication-provider>
    </authentication-manager>
    
<!--     <authentication-manager> -->
<!--         <authentication-provider> -->
<!--             <user-service> -->
<!--                 <user name="admin" password="admin" authorities="ROLE_ADMIN" /> -->
<!--                 <user name="user" password="user" authorities="ROLE_USER" /> -->
<!--             </user-service> -->
<!--         </authentication-provider> -->
<!--     </authentication-manager> -->
    
   
    
<!-- 	<beans:bean id="expressionHandler" class="org.springframework.security.web.access.expression.DefaultWebSecurityExpressionHandler" /> -->
</beans:beans>
